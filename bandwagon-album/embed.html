{{- $streamID := .StreamID -}}
{{- $songs := .Children.Top120.ByRank.Slice -}}
{{- $releaseDate := .Data "releaseDate" -}}

<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="/.themes/global/stylesheet?v={{.ETag}}" rel="preload" />
	<link rel="stylesheet" type="text/css" href="/{{.StreamID}}/stylesheet?v={{.ETag}}" rel="preload" />
	<link rel="stylesheet" type="text/css" href="/.themes/global/resources/bootstrap-icons-1.11.3/font/bootstrap-icons.css" rel="preload">
</head>

<body script="install MediaPlayer" class="padding-none margin-none scroll-none" style="background-color:var(--page-background);">

	<div style="display:flex; align-items:stretch; width:100vw; height:100vh;">

		<div class="width-33% flex-grow-0 flex-shrink-0">
			<img id="album-icon" src="{{.IconURL}}" aria-hidden="true" class="media-Image width-100%" style="object-fit:cover;">
		</div>

		<div class="width-66% flex-grow-0 flex-shrink-0 flex-column">
			
			<audio hidden></audio>

			<a href="/{{.StreamID}}" target="_blank" class="block flex-row flex-align-stretch padding-sm padding-bottom-none text-lg text-plain bold margin-none" style="color:var(--text-color); max-width-100%;">
				<div class="hide-visual">Album Name:</div>
				<div class="media-Name ellipsis">{{.Label}}</div>
				<div class="flex-grow align-right">
					{{icon "new-window"}}
				</div>
			</a>
			<a href="/{{.StreamID}}" target="_blank" class="block padding-sm padding-top-none text-plain text-sm margin-none ellipsis" style="color:var(--text-color);">
				<span class="hide-visual">Artist:</span>
				<span class="media-Artist">
					{{.AttributedTo.Name}}
					{{- if ne nil $releaseDate }}
						&middot; {{year $releaseDate}}
					{{- end -}}
				</span>
			</a>

			<div class="padding-sm flex-grow">

				<!-- Player Controls -->
				<div class="media-show-when-paused flex-row flex-align-center">
					<button class="media-Play primary">{{icon "play-fill"}} Play</button>
					{{- if .StreamHasPrivileges -}}
						<a href="/{{.StreamID}}/checkout" class="button outline" target="_blank">
							<span class="htmx-request-hide">{{icon "star"}}</span>
							<span class="htmx-request-show"><span class="spin">{{icon "loading"}}</span></span>
							{{- $checkoutLabel := first (.Data "checkout label") "Buy Now" -}}
							{{$checkoutLabel}}
						</a>
					{{- end -}}
				</div>

				<div class="media-show-when-playing flex-row flex-align-center text-sm" style="display:none;">
					<button class="media-Prev margin-right-none" aria-label="Skip Backward">{{icon "skip-backward-fill"}}</button>
					<button class="media-Pause primary margin-right-none" aria-label="Pause Playback">{{icon "pause-fill"}}</button>
					<button class="media-Next margin-right" aria-label="Skip Forward">{{icon "skip-forward-fill"}}</button>
					<div class="media-Progress flex-grow" script="install Slider" style="background-color:#CCC; border:solid 1px #333;"></div>
				</div>

				<!-- Song List -->
				{{- range $index, $song := $songs -}}
					<div id="track-{{$index}}" class="track clickable flex-row" 
						data-track-name="{{$song.Name}}"
						data-track-artist="{{$song.Data.artist}}"
						data-track-image="{{$song.IconURL}}"
						data-track-url="/{{$song.StreamID}}/attachments/{{$song.Data.attachmentId}}.opus?bitrate=128&v=2"></div>
				{{- end -}}
					
			</div>

			<div class="padding-sm text-xs text-gray" style="color:var(--text-color);">{{template "license" .}}</div>
		</div>
	</div>
</body>

<script type="text/hyperscript" src="/.themes/global/hyperscript"></script>
<script type="text/javascript" src="/.themes/global/resources/htmx/htmx.min.js" rel="preload"></script>
<script type="text/javascript" src="/.themes/global/resources/hyperscript/_hyperscript.min.js" rel="preload"></script>
<script type="text/javascript" src="/.themes/global/javascript" rel="preload"></script>

</html>